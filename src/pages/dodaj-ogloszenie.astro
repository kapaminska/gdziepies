---
import Layout from '../layouts/Layout.astro';
import { AdForm } from '../components/announcements/AdForm';

// Try to get user, but don't redirect here - let AdForm handle it client-side
// This allows the page to load and check auth in the browser
const {
  data: { user },
} = await Astro.locals.supabase.auth.getUser();

const supabaseUrl = import.meta.env.SUPABASE_URL;
const supabaseKey = import.meta.env.SUPABASE_KEY;
---

<Layout title="Dodaj ogÅ‚oszenie">
  <main class="container mx-auto px-4 py-8">
    <script define:vars={{ supabaseUrl, supabaseKey }}>
      // Inject Supabase config into window for client-side access
      window.__SUPABASE_URL__ = supabaseUrl;
      window.__SUPABASE_KEY__ = supabaseKey;
    </script>
    <AdForm
      client:only="react"
      mode="create"
      initialUserId={user?.id}
      supabaseUrl={supabaseUrl}
      supabaseKey={supabaseKey}
    />
  </main>
</Layout>

