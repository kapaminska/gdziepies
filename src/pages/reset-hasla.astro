---
import Layout from '../layouts/Layout.astro';
import { PasswordResetConfirmForm } from '../components/auth/PasswordResetConfirmForm';

// Check if user is already logged in
const {
  data: { user },
  error: authError,
} = await Astro.locals.supabase.auth.getUser();

if (!authError && user) {
  return Astro.redirect('/');
}

// Get token and type from query params
const token = Astro.url.searchParams.get('token') || undefined;
const type = Astro.url.searchParams.get('type') || undefined;

// Pass Supabase config to client component
const supabaseUrl = import.meta.env.SUPABASE_URL;
const supabaseKey = import.meta.env.SUPABASE_KEY;
---

<Layout title="Resetowanie hasÅ‚a">
  <main class="container mx-auto px-4 py-8">
    <script define:vars={{ supabaseUrl, supabaseKey }}>
      // Inject Supabase config into window for client-side access
      window.__SUPABASE_URL__ = supabaseUrl;
      window.__SUPABASE_KEY__ = supabaseKey;
    </script>
    <PasswordResetConfirmForm
      token={token}
      type={type}
      supabaseUrl={supabaseUrl}
      supabaseKey={supabaseKey}
      client:load
    />
  </main>
</Layout>



