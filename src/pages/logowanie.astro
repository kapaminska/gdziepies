---
import Layout from '../layouts/Layout.astro';
import { AuthForm } from '../components/auth/AuthForm';
import { getSupabaseConfig } from '@/lib/supabase-config';

// Check if user is already logged in
const {
  data: { user },
  error: authError,
} = await Astro.locals.supabase.auth.getUser();

if (!authError && user) {
  return Astro.redirect('/');
}

// Pass Supabase config to client component
const { url: supabaseUrl, key: supabaseKey } = getSupabaseConfig();

// Get redirect URL from query params
const redirectTo = Astro.url.searchParams.get('redirectTo') || '/';
---

<Layout title="Logowanie">
  <main class="container mx-auto px-4 py-8">
    <script define:vars={{ supabaseUrl, supabaseKey }}>
      // Inject Supabase config into window for client-side access
      window.__SUPABASE_URL__ = supabaseUrl;
      window.__SUPABASE_KEY__ = supabaseKey;
    </script>
    <AuthForm
      mode="login"
      supabaseUrl={supabaseUrl}
      supabaseKey={supabaseKey}
      redirectTo={redirectTo}
      client:load
    />
  </main>
</Layout>
